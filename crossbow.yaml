watch:
  default:
    before:
      - docker
      - bs --init
    _src:
      - templates
      - bs --reload
    scss:
      - crossbow-sass --production

tasks:

  build-all@p:
    description: Create Production Assets
    tasks:
      - templates
      - crossbow-sass --production
      - icons
      - _merkle

  _merkle:
    - merkle --dir public-html
    - merkle --dir public/css

  docker:
    description: Run docker-compose with **dev** config files
    tasks:
      - '@sh docker-compose -f docker-compose-dev.yaml up -d'
      - '@sh docker ps'

  templates:
    description: Compile HTML Templates from `_src` directory
    tasks:
      - crossbow

  deploy:
    description: Build-all assets & rsync to server
    tasks:
      - build-all
      - rsync

  rsync:
    description: Copy files from local to remote server
    tasks:
      - >
        @sh rsync -ra
        public public-html docker-compose.yaml nginx.conf
        $AUTH:~/yes.gg --delete

  open:
    description: Open the live site for previewing
    input: '@sh open http://$DO_IP'

env:
  AUTH: root@178.62.100.243
  DO_IP: 178.62.100.243
  DO_USER: root

options:
  crossbow:
    config:
      base: '_src'
      prettyUrls: true
      defaultLayout: 'default.hbs'
    input:
      - _src/*.hbs
    output: 'public-html'
    data:
      $$: "all:data"

  bs:
    proxy: 0.0.0.0:8080

  crossbow-sass:
    input: scss/core.scss
    output: public/css

  icons:
    input: public/img/svg/**
    output: public/img/icons